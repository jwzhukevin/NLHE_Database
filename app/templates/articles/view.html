{% extends 'base.html' %}

{% block page_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/article_view.css', v='20250913') }}">
{% endblock %}

{% block content %}
<div class="article-layout-wide">
    <!-- 目录区域，主容器外部 -->
    <nav id="article-toc" class="article-toc" aria-label="{{ _('Table of contents') }}"></nav>
<div class="article-container">
    <!-- Breadcrumbs Navigation -->
    <div class="breadcrumbs">
        <a href="{{ url_for('articles.listing') }}">{{ _('Contents') }}</a>
        <span class="separator">&gt;</span>
        <a href="{{ url_for('articles.listing', category=category) }}">{{ category|title }}</a>
        <span class="separator">&gt;</span>
        <span class="current">{{ article.title }}</span>
    </div>
        <div class="article-main-content">
    <!-- Article Header -->
    <header class="article-header">
        <div class="article-category {{ category|lower }}">{{ category|title }}</div>
        <h1 class="article-title">{{ article.title }}</h1>
        <div class="article-meta">
            {% if article.date %}
            <span class="article-date">
                <i class="far fa-calendar-alt"></i> {{ article.date }}
            </span>
            {% endif %}
        </div>
    </header>
    <!-- Article Content -->
    <div class="article-content markdown-body">
        {{ content|safe }}
    </div>
    <!-- Article Footer -->
    <div class="article-footer">
        <a href="{{ url_for('articles.listing') }}" class="back-button">
            <i class="fas fa-arrow-left"></i> {{ _('Back to Contents') }}
        </a>
            </div>
        </div>
    </div>
</div>

<!-- [Deprecated 20250913] 内联样式已迁移至 static/css/pages/article_view.css -->
<!-- i18n 文案以 JSON 注入供脚本安全读取 -->
<script type="application/json" id="articles-i18n">
  {{ {
    'tocTitle': _('Contents')
  } | tojson }}
</script>
<script>
// 自动生成目录（TOC）脚本，适合新手理解
window.addEventListener('DOMContentLoaded', function() {
    const content = document.querySelector('.article-content');
    const toc = document.getElementById('article-toc');
    if (!content || !toc) return;
    // 解析 i18n JSON
    const i18n = JSON.parse(document.getElementById('articles-i18n').textContent);
    // 查找所有h1~h3标题
    const headings = content.querySelectorAll('h1, h2, h3');
    if (headings.length < 2) {
        toc.style.display = 'none';
        return;
    }
    // 生成锚点id并构建目录树
    let tocHtml = '<div class="toc-title">' + i18n.tocTitle + '</div><ul>';
    headings.forEach(function(h, idx) {
        // 生成唯一id
        if (!h.id) h.id = 'toc-h-' + idx;
        let indent = '';
        let linkClass = '';
        if (h.tagName === 'H1') { linkClass = 'toc-h1-link'; }
        if (h.tagName === 'H2') { indent = '&nbsp;&nbsp;&nbsp;'; linkClass = 'toc-h2-link'; }
        if (h.tagName === 'H3') { indent = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; linkClass = 'toc-h3-link'; }
        tocHtml += `<li>${indent}<a href="#${h.id}" class="${linkClass}">${h.textContent}</a></li>`;
    });
    tocHtml += '</ul>';
    toc.innerHTML = tocHtml;
});
</script>
{% endblock %} 