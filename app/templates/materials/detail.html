{% extends 'base.html' %}
{# 继承base.html模板，这使得detail.html可以共享base.html中定义的全局结构 #}

{% block content %}
{# 开始内容块，将覆盖base.html中相应的块 #}

<!-- ====================== 外部脚本引入 ====================== -->
<!-- 确保Inter字体加载 -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- Three.js相关脚本：用于创建和渲染3D晶体结构模型 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"
        onerror="console.warn('Three.js CDN加载失败，3D功能将不可用')"></script>
<!-- Three.js轨道控制器：允许用户旋转、平移和缩放3D模型 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"
        onerror="console.warn('OrbitControls CDN加载失败，3D控制功能将不可用')"></script>
<!-- 备用OrbitControls加载和错误处理 -->
<script>
// 延迟检查库是否加载成功
setTimeout(function() {
    if (typeof THREE === 'undefined') {
        console.warn('⚠️ Three.js库未加载，3D晶体结构功能将不可用');
        // 可以在这里添加用户友好的提示
        const crystalContainer = document.getElementById('crystal-container');
        if (crystalContainer) {
            crystalContainer.innerHTML = '<div class="alert alert-warning">3D晶体结构功能暂时不可用（网络连接问题）</div>';
        }
    } else if (!THREE.OrbitControls) {
        console.log("尝试加载备用OrbitControls...");
        const script = document.createElement('script');
        script.src = 'https://threejs.org/examples/js/controls/OrbitControls.js';
        script.onerror = function() {
            console.warn('⚠️ OrbitControls加载失败，3D控制功能受限');
        };
        document.head.appendChild(script);
    }
}, 1000);
</script>
<!-- 自定义晶体查看器脚本：实现晶体结构的交互式展示 -->
<script type="text/javascript" src="{{ url_for('static', filename='js/crystal-viewer.js') }}"></script>

<!-- 加载能带分析配置 -->
<script>
// 加载统一的能带分析配置
fetch('/api/band-config')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.bandConfig = data.config;
            console.log('✅ 能带分析配置已加载:', window.bandConfig);
        } else {
            console.warn('⚠️ 能带分析配置加载失败，使用默认值');
            window.bandConfig = {
                fermiLevel: 0,
                tolerance: 0.1,
                metalThreshold: 0.0,
                semimetalThreshold: 0.1,
                semiconductorThreshold: 3.0
            };
        }
    })
    .catch(error => {
        console.warn('⚠️ 能带分析配置加载失败，使用默认值:', error);
        window.bandConfig = {
            fermiLevel: 0,
            tolerance: 0.1,
            metalThreshold: 0.0,
            semimetalThreshold: 0.1,
            semiconductorThreshold: 3.0
        };
    });
</script>

<!-- 能带结构脚本：用于绘制和交互式显示材料的电子能带结构 -->
<script type="text/javascript" src="{{ url_for('static', filename='js/band-plot.js') }}"></script>

<!-- SC结构相关脚本 -->
<!-- Plotly.js：强大的图表库，用于创建交互式图表 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/plotly.js@2.18.0/dist/plotly.min.js"
        onerror="console.warn('Plotly.js CDN加载失败，图表功能将不可用')"></script>
<!-- Plotly.js错误处理 -->
<script>
// 延迟检查Plotly是否加载成功
setTimeout(function() {
    if (typeof Plotly === 'undefined') {
        console.warn('⚠️ Plotly.js库未加载，图表功能将不可用');
        // 可以在这里添加用户友好的提示
        const scContainer = document.getElementById('sc-plot-container');
        if (scContainer) {
            scContainer.innerHTML = '<div class="alert alert-warning">图表功能暂时不可用（网络连接问题）</div>';
        }
    }
}, 1000);
</script>
<!-- 自定义SC结构绘图脚本：处理SC结构数据的可视化 -->
<script type="text/javascript" src="{{ url_for('static', filename='js/sc-plot.js') }}"></script>


<!-- ====================== 材料导航栏 ====================== -->
<div class="material-nav">
    <div class="material-nav-wrapper">
        <!-- 导航栏主体：面包屑+属性导航（左对齐）+ 功能按钮（右对齐） -->
        <div class="nav-main-container">
            <!-- 左侧：面包屑导航 + 属性导航链接 -->
            <div class="nav-left-section">
                <!-- 面包屑导航 -->
                <div class="breadcrumb-nav">
                    <a href="{{ url_for('views.landing') }}" class="breadcrumb-link">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <span class="breadcrumb-separator">
                        <i class="fas fa-chevron-right"></i>
                    </span>
                    <a href="{{ url_for('views.index') }}" class="breadcrumb-link">Materials</a>
                    <span class="breadcrumb-separator">
                        <i class="fas fa-chevron-right"></i>
                    </span>
                    <span class="breadcrumb-current">{{ material.name }} ({{ material.formatted_id }})</span>
                </div>

                <!-- 属性导航链接 -->
                <div class="nav-properties">
                    <a href="#first-section" class="nav-property-link active">Structure</a>
                    <a href="#second-section" class="nav-property-link">Crystal Data</a>
                    <a href="#third-section" class="nav-property-link">Band Structure</a>
                    <a href="#sc-section" class="nav-property-link">SC</a>
                    <a href="#fourth-section" class="nav-property-link">Properties</a>
                </div>
            </div>

            <!-- 右侧：功能按钮 -->
            <div class="nav-actions">
                <!-- Materials Project外部链接 -->
                <a href="https://next-gen.materialsproject.org/materials?formula={{ material.name }}" target="_blank"
                   class="action-btn mp-btn">
                    <i class="fas fa-external-link-alt"></i>
                    <span>MP</span>
                </a>

                <!-- 搜索返回按钮 -->
                {% if request.referrer and 'q=' in request.referrer %}
                <a href="{{ request.referrer }}" class="action-btn back-btn">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back</span>
                </a>
                {% endif %}

                <!-- 管理员专用功能：仅在管理员用户登录时显示 -->
                {% if current_user.is_authenticated and current_user.is_admin() %}
                <a href="{{ url_for('views.edit', material_id=material.id) }}"
                   class="action-btn edit-btn">
                    <i class="fas fa-edit"></i>
                    <span>Edit</span>
                </a>

                <a method="post" action="{{ url_for('views.delete', material_id=material.id) }}"
                   type="submit" onclick="return confirm('Delete permanently?')"
                   class="action-btn delete-btn">
                    <i class="fas fa-trash-alt"></i>
                    <span>Delete</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- ====================== 主容器 ====================== -->
<div class="material-detail-container">
    <style>
    /* ===== 页面全局样式 ===== */
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        background: #f8fafc; /* 设置浅灰色背景,提供柔和的视觉效果 */
        font-family: 'Inter', sans-serif; /* 使用Inter字体,提供现代感 */
    }
    
    /* ===== 主容器布局样式 ===== */
    .material-detail-container {
        max-width: 1600px; /* 限制最大宽度,避免在大屏幕上过宽 */
        margin:2px auto 0; /* 上边距2px,水平居中 */
        padding: 16px; /* 四周内边距16px,提供内容呼吸空间 */
        background: #f8fafc; /* 与body背景色保持一致 */
    }
    




    /* 材料ID样式 */
    .material-id {
        font-size: 1.1rem;
        font-weight: 500;
        color: white;
        background-color: rgba(255, 255, 255, 0.2);
        padding: 8px 16px;
        border-radius: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    /* ===== 材料导航栏 - 参照顶部导航栏设计 ===== */

    /* 导航栏容器 - 贯穿整个网页，无背景设计 */
    .material-nav {
        background: transparent; /* 透明背景 */
        border-bottom: none; /* 移除底部边框 */
        box-shadow: none; /* 移除阴影 */
        position: sticky;
        top: 64px; /* 距离顶部导航栏的高度 */
        z-index: 100;
        width: 100%; /* 贯穿整个网页宽度 */
        padding: 16px 0; /* 上下内边距 */
        margin: 0; /* 移除外边距 */
    }

    /* 导航栏内容包装器 - 使用container类，与顶部导航栏保持一致 */
    .material-nav-wrapper {
        max-width: 1600px;
        margin: 0 auto;
        padding: 0 24px;
        width: 100%;
        box-sizing: border-box;
    }

    /* 主导航容器 - 左右对齐布局 */
    .nav-main-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 24px;
    }

    /* 左侧导航区域 - 面包屑 + 属性导航 */
    .nav-left-section {
        display: flex;
        align-items: center;
        gap: 24px;
        flex: 1;
    }

    /* 面包屑导航 - 简洁样式 */
    .breadcrumb-nav {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1.1rem;
        color: #64748b;
        white-space: nowrap;
    }

    .breadcrumb-link {
        color: #64748b;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 6px;
        background-color: white;
        border: 1px solid #e2e8f0;
        position: relative;
    }

    .breadcrumb-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 8px;
        right: 8px;
        height: 2px;
        background-color: transparent;
        transition: background-color 0.3s ease;
    }

    .breadcrumb-link:hover {
        color: #0047AB;
        background-color: white;
        border-color: rgba(0, 71, 171, 0.3);
        transform: translateY(-1px);
        box-shadow: 0 2px 6px rgba(0, 71, 171, 0.12);
    }

    .breadcrumb-link:hover::after {
        background-color: #0047AB;
    }

    .breadcrumb-separator {
        color: #cbd5e1;
        font-size: 0.9rem;
        margin: 0 2px;
    }

    .breadcrumb-current {
        color: #0047AB;
        font-weight: 700;
        padding: 4px 8px;
        background-color: white;
        border-radius: 6px;
        border: 1px solid rgba(0, 71, 171, 0.2);
        box-shadow: 0 1px 4px rgba(0, 71, 171, 0.1);
    }

    /* 属性导航 - 简洁样式 */
    .nav-properties {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-property-link {
        padding: 10px 16px;
        color: #475569;
        text-decoration: none;
        font-size: 0.95rem;
        font-weight: 600;
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .nav-property-link:hover {
        color: #0047AB;
        background-color: white;
        border-color: rgba(0, 71, 171, 0.5);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0, 71, 171, 0.15);
    }

    .nav-property-link.active {
        color: white;
        background-color: #0047AB;
        border-color: #0047AB;
        font-weight: 700;
        box-shadow: 0 2px 8px rgba(0, 71, 171, 0.3);
    }

    /* 功能按钮区域 */
    .nav-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* 功能按钮 - 简洁设计 */
    .action-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 10px 16px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .action-btn i {
        font-size: 0.9rem;
    }

    .action-btn span {
        font-weight: 600;
    }

    /* MP按钮 - 蓝色主题 */
    .mp-btn {
        color: #1e40af;
        background-color: #eff6ff;
        border-color: #bfdbfe;
    }

    .mp-btn:hover {
        color: white;
        background-color: #1e40af;
        border-color: #1e40af;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
    }

    /* 返回按钮 - 灰色主题 */
    .back-btn {
        color: #475569;
        background-color: #f8fafc;
        border-color: #e2e8f0;
    }

    .back-btn:hover {
        color: #1e293b;
        background-color: #e2e8f0;
        border-color: #cbd5e1;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(71, 85, 105, 0.2);
    }

    /* 编辑按钮 - 绿色主题 */
    .edit-btn {
        color: #059669;
        background-color: #ecfdf5;
        border-color: #a7f3d0;
    }

    .edit-btn:hover {
        color: white;
        background-color: #059669;
        border-color: #059669;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
    }

    /* 删除按钮 - 红色主题 */
    .delete-btn {
        color: #dc2626;
        background-color: #fef2f2;
        border-color: #fecaca;
    }

    .delete-btn:hover {
        color: white;
        background-color: #dc2626;
        border-color: #dc2626;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }

    /* 按钮激活状态 */
    .action-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    /* ===== 响应式设计 ===== */

    /* 平板设备 */
    @media (max-width: 1200px) {
        .material-nav {
            padding: 14px 0; /* 调整上下内边距 */
        }

        .material-nav-wrapper {
            padding: 0 20px;
        }

        .nav-main-container {
            flex-direction: column;
            gap: 16px;
            align-items: stretch;
        }

        .nav-left-section {
            flex-direction: column;
            gap: 12px;
            align-items: flex-start;
            flex: none;
        }

        .breadcrumb-nav {
            font-size: 1rem;
        }

        .nav-properties {
            gap: 6px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        .nav-property-link {
            padding: 8px 14px;
            font-size: 0.9rem;
        }

        .nav-actions {
            gap: 8px;
            justify-content: flex-start;
        }

        .action-btn {
            padding: 8px 14px;
            font-size: 0.85rem;
        }
    }
    
    /* 移动设备 */
    @media (max-width: 768px) {
        .material-nav {
            padding: 12px 0; /* 调整上下内边距 */
        }

        .material-nav-wrapper {
            padding: 0 16px;
        }

        .nav-main-container {
            gap: 12px;
        }

        .nav-left-section {
            gap: 10px;
            width: 100%;
        }

        .breadcrumb-nav {
            font-size: 0.95rem;
        }

        .breadcrumb-current {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nav-properties {
            gap: 4px;
            width: 100%;
        }

        .nav-property-link {
            padding: 8px 10px;
            font-size: 0.8rem;
            flex: 1;
            text-align: center;
            min-width: 0;
        }

        .nav-actions {
            gap: 6px;
            justify-content: flex-start;
        }

        .action-btn {
            padding: 8px 10px;
            font-size: 0.8rem;
        }

        .action-btn span {
            display: none; /* 移动端只显示图标 */
        }

        .action-btn i {
            font-size: 1rem;
        }
    }

    /* ===== 内容区域布局样式 ===== */
    
    /* 内容区块样式 - 每个主要内容部分（如结构、晶体数据等）的容器 */
    .content-section {
        margin-bottom: 20px; /* 区块之间添加30px的底部间距，提高可读性 */
    }
    
    /* 两列布局容器 - 用于并排展示相关信息 */
    .two-column-layout {
        display: flex;
        gap: 24px;
        margin-bottom: 24px;
        align-items: stretch; /* 确保所有列高度相同 */
    }
    
    /* 宽列样式 - 用于主要内容展示（占60%宽度） */
    .column-60 {
        flex: 6; /* 在弹性分配中占6份，实际效果约为60%宽度 */
        display: flex; /* 使用弹性布局 */
        flex-direction: column; /* 垂直排列子元素 */
        height: 100%; /* 确保列高度一致 */
    }
    
    /* 窄列样式 - 用于辅助内容展示（占40%宽度） */
    .column-40 {
        flex: 4; /* 在弹性分配中占4份，实际效果约为40%宽度 */
        display: flex; /* 使用弹性布局 */
        flex-direction: column; /* 垂直排列子元素 */
        height: 100%; /* 确保列高度一致 */
    }

    /* SC部分专用：70%宽度列 */
    .column-70 {
        flex: 7; /* 在弹性分配中占7份，实际效果约为70%宽度 */
        display: flex; /* 使用弹性布局 */
        flex-direction: column; /* 垂直排列子元素 */
        height: 100%; /* 确保列高度一致 */
    }

    /* SC部分专用：30%宽度列 */
    .column-30 {
        flex: 3; /* 在弹性分配中占3份，实际效果约为30%宽度 */
        display: flex; /* 使用弹性布局 */
        flex-direction: column; /* 垂直排列子元素 */
        height: 100%; /* 确保列高度一致 */
    }
    
    /* SC布局的列样式 */
    .column-80 {
        flex: 8;
        display: flex;
        flex-direction: column;
        height: 100%; /* 确保列高度一致 */
    }
    
    .column-20 {
        flex: 2;
        display: flex;
        flex-direction: column;
        height: 100%; /* 确保列高度一致 */
    }

    /* ===== 卡片组件样式 ===== */
    
    /* 详情卡片 - 包含标题和内容的基本信息展示组件 */
    .detail-card {
        background: #fff; /* 纯白色背景，提供干净的视觉效果 */
        border-radius: 12px; /* 圆角边框，增加现代感 */
        box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px; /* 轻微阴影，增加层次感 */
        margin-bottom: 20px; /* 底部间距20px，分隔相邻卡片 */
        transition: all 0.2s ease; /* 所有属性变化添加平滑过渡 */
        border: 1px solid #e5e7eb; /* 浅灰色边框，增强边界感 */
        overflow: hidden; /* 隐藏超出边界的内容，保持整洁 */
        flex: 1; /* 让卡片在其容器中扩展，占据所有可用空间 */
        display: flex; /* 使用弹性布局 */
        flex-direction: column; /* 垂直排列内容 */
        height: 100%; /* 确保卡片高度填满整个容器 */
    }
    
    /* 查看器容器也应具有相同的伸缩特性 */
    .viewer-container {
        flex: 1; /* 与detail-card一致，占据所有可用空间 */
        display: flex;
        flex-direction: column;
        height: 100%; /* 确保查看器容器高度填满整个容器 */
    }
    
    /* 卡片内容应该可以伸缩 */
    .card-content, .viewer-content {
        flex: 1; /* 允许内容区域伸缩以填充剩余空间 */
        display: flex; /* 使用弹性布局 */
        flex-direction: column; /* 垂直排列内容 */
    }

    /* 卡片悬停效果 - 增强用户交互反馈 */
        .detail-card:hover {
        box-shadow: rgba(0, 0, 0, 0.15) 0px 8px 24px; /* 悬停时增强阴影效果，提高视觉突出度 */
        }

    /* 卡片头部 - 包含标题和折叠控制按钮 */
        .card-header {
        display: flex; /* 弹性布局，便于排列标题和控制按钮 */
        align-items: center; /* 子元素垂直居中 */
        justify-content: space-between; /* 标题靠左，按钮靠右 */
        background: linear-gradient(to right, #f1f5f9, #f8fafc); /* 从左到右的浅色渐变背景 */
        border-bottom: 1px solid #e5e7eb; /* 底部边框，与卡片内容区域分隔 */
        padding: 16px 20px; /* 上下内边距16px，左右内边距20px，确保足够的空间 */
        cursor: pointer; /* 鼠标指针变为手型，提示可点击 */
        }

    /* 卡片标题样式 */
        .card-header h3 {
        margin: 0; /* 移除默认外边距 */
        color: #1e293b; /* 深蓝灰色文本，提供良好对比度 */
        font-size: 1.3rem; /* 字体大小适中，突出重要性但不过分夸张 */
        font-weight: 600; /* 字体加粗，增强可读性 */
        }
    
    /* 卡片折叠/展开图标 */
    .card-header .toggle-icon {
        color: #64748b; /* 图标使用灰色，不抢视觉焦点 */
        transition: transform 0.3s ease; /* 旋转变换添加平滑过渡效果 */
    }
    
    /* 折叠状态下的图标旋转效果 */
    .card-header.collapsed .toggle-icon {
        transform: rotate(-90deg); /* 图标旋转-90度，提供视觉状态指示 */
        }

    /* 卡片内容区域 */
        .card-content {
        padding: 20px; /* 四周内边距20px，提供内容呼吸空间 */
        transition: max-height 0.3s ease, opacity 0.3s ease; /* 高度和透明度变化添加平滑过渡 */
        max-height: 2000px; /* 展开状态下的最大高度，足够容纳大多数内容 */
        opacity: 1; /* 完全不透明，内容清晰可见 */
        overflow: hidden; /* 隐藏超出高度限制的内容 */
        overflow-y: auto; /* 添加垂直滚动条，当内容超出时可滚动 */
        min-height: 200px; /* 设置最小高度，确保即使内容少也有一定高度 */
    }
    
    /* 折叠状态下的内容区域 */
    .card-content.collapsed {
        max-height: 0; /* 高度为0，内容完全隐藏 */
        padding: 0 20px; /* 上下内边距为0，左右保持20px，防止内容突然变化 */
        opacity: 0; /* 完全透明，内容不可见 */
        min-height: 0; /* 折叠状态下不需要最小高度 */
    }

        .card-content ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .card-content li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .card-content li:last-child {
            border-bottom: none;
        }

        .property-label {
            color: #64748b;
            font-weight: 500;
        font-size: 1.05rem;
        }

        .property-value {
            color: #0047AB;
            font-weight: 600;
        padding: 6px 14px;
            background: #F5F8FF;
            border-radius: 6px;
        font-size: 1.05rem;
        }

    /* 原子坐标表格样式 */
    .atom-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 1.05rem;
        font-family: 'Inter', sans-serif; /* 使用与base.html相同的字体 */
    }
    
    .atom-table th {
        background-color: #f1f5f9;
        color: #334155;
        font-weight: 600;
        text-align: center;
    padding: 12px 10px;
        border-bottom: 2px solid #e5e7eb;
        position: sticky;
        top: 0;
        z-index: 1;
    font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .atom-table td {
    padding: 12px 10px;
        text-align: center;
        border-bottom: 1px solid #e5e7eb;
        transition: background-color 0.2s ease;
    }
    
    .atom-table tbody tr:nth-child(odd) {
        background-color: #f8fafc;
    }
    
    .atom-table tbody tr:hover {
        background-color: #EFF6FF;
    }
    
    .atom-coords-container {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        margin-top: 8px;
        scrollbar-width: thin;
        scrollbar-color: #94a3b8 #f1f5f9;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    
    .atom-coords-container::-webkit-scrollbar {
        width: 8px;
    }
    
    .atom-coords-container::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 6px;
    }
    
    .atom-coords-container::-webkit-scrollbar-thumb {
        background-color: #94a3b8;
        border-radius: 6px;
        border: 2px solid #f1f5f9;
    }

.atom-coords-container::-webkit-scrollbar-thumb:hover {
    background-color: #0047AB;
}
    
    .atom-info {
    margin-bottom: 15px;
        color: #475569;
    font-size: 1.05rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .atom-info p {
        margin: 0;
        line-height: 1.5;
    }
    
    .coordinates-toggle {
    display: flex;
    margin-bottom: 12px;
    justify-content: flex-start;
}

.coordinates-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    margin-top: 6px;
}

.coords-display-info {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
    color: #475569;
    padding: 6px 12px;
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    border: 1px solid #e5e7eb;
    justify-content: flex-end;
}

.coords-toggle-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(to right, #EFF6FF, #DBEAFE);
    color: #0047AB;
    border: 1px solid #BFDBFE;
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0, 71, 171, 0.15);
    position: relative;
    overflow: hidden;
    min-width: 150px;
}

.coords-toggle-btn:hover {
    background: linear-gradient(to right, #DBEAFE, #BFDBFE);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 71, 171, 0.3);
}

.coords-toggle-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 3px rgba(0, 71, 171, 0.2);
}

.coords-toggle-btn i {
    margin-right: 8px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.coords-toggle-btn.active {
    background: linear-gradient(to right, #0047AB, #1E40AF);
    color: white;
}

.coords-toggle-btn.active i {
    transform: rotate(180deg);
}

.coords-toggle-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to right, rgba(255,255,255,0.1), rgba(255,255,255,0.3));
    transform: translateX(-100%);
    transition: transform 0.6s ease;
}

.coords-toggle-btn:hover::before {
    transform: translateX(100%);
    }
    
    .toggle-label {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-size: 0.85rem;
        color: #64748b;
        transition: color 0.2s ease;
    }
    
    .toggle-label:hover {
        color: #0047AB;
    }
    
    .toggle-label input {
        margin-right: 6px;
    }
    
    .atom-element {
        font-weight: 600;
        color: #0047AB;
    font-size: 1.05rem;
    }
    
    .atom-coords {
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        letter-spacing: 0.5px;
        color: #334155;
    font-size: 1.05rem;
    }
    
.atom-total {
    font-size: 1.5rem;
    font-weight: 700;
        color: #1e293b;
    }
    
    .atom-composition {
        font-style: italic;
        color: #64748b;
    font-size: 1rem;
    }
    
    /* 3D结构查看器样式 */
    .viewer-container {
        background: #fff;
        border-radius: 12px;
        box-shadow: rgba(17, 12, 46, 0.1) 0px 8px 24px;
        border: 1px solid #e5e7eb;
        overflow: hidden;
        margin-bottom: 20px;
        transition: all 0.3s ease;
        height: 100%; /* 确保高度一致 */
    }
    
    .viewer-container:hover {
        box-shadow: rgba(0, 0, 0, 0.15) 0px 8px 24px;
    }

    .viewer-content {
        padding: 0 20px 20px;
        transition: max-height 0.3s ease, opacity 0.3s ease;
        max-height: 2000px;
        opacity: 1;
        overflow: hidden;
        display: flex; /* 使用弹性布局 */
        flex-direction: column; /* 垂直排列内容 */
        flex: 1; /* 填充剩余空间 */
        min-height: 625px; /* 确保与crystal-viewer一致的最小高度 */
    }
    
    .viewer-content.collapsed {
        max-height: 0;
        padding: 0 20px;
        opacity: 0;
        min-height: 0; /* 折叠状态下不需要最小高度 */
    }

    .crystal-viewer {
        width: 100%;
        height: 625px; /* 固定高度 */
        border-radius: 8px;
        background: #f8fafc;
        border: 2px solid #e2e8f0;
        overflow: hidden;
        transition: all 0.3s ease;
        position: relative;
        flex: 1; /* 填充剩余空间 */
        min-height: 625px; /* 确保最小高度 */
    }

    /* 确保3D查看器控件不会覆盖导航栏 */
    .crystal-viewer canvas, 
    .crystal-viewer div {
        z-index: 10 !important; /* 强制降低z-index */
    }
    
    /* 能带结构图样式 */
    #bandStructure, #scStructure {
        width: 100%;
        flex-grow: 1; /* 让图表容器填充剩余空间 */
        min-height: 625px; /* 确保最小高度 */
        height: 625px; /* 固定高度，与crystal-viewer一致 */
        border-radius: 8px;
        background: #f8fafc;
        border: 2px solid #e2e8f0;
        overflow: hidden;
        transition: all 0.3s ease;
        position: relative;
    }

    /* 共享交互效果 */
    .crystal-viewer:hover, #bandStructure:hover, #scStructure:hover {
        border-color: #0047AB;
        box-shadow: rgba(0, 71, 171, 0.15) 0px 0px 0px 4px;
    }

    /* 响应式调整 */
    @media (max-width: 1200px) {
        .two-column-layout {
            flex-direction: column;
        }
        
        .column-60, .column-40 {
            flex: 1;
            width: 100%;
        }
        
        .crystal-viewer, #bandStructure, #scStructure, .viewer-content {
            height: 500px; /* 调整高度 */
            min-height: 500px; /* 调整最小高度 */
        }
        
        #sc-plot {
            min-height: 400px; /* 减小高度，为图例留出空间 */
        }
    }
    
    @media (max-width: 768px) {
        .material-detail-container {
            padding: 16px;
            margin-top: 200px; /* 在小屏幕上增加更多的顶部间距以适应新导航栏 */
        }
        
        .material-nav {
            height: auto;
            flex-direction: column;
            padding: 15px;
            top: 56px; /* 在小屏幕上，主导航栏通常更窄 */
        }
        

        

        


        .crystal-viewer, #bandStructure, #scStructure, .viewer-content {
            height: 375px; /* 调整高度 */
            min-height: 375px; /* 调整最小高度 */
        }
        
        #sc-plot {
            min-height: 300px; /* 减小高度，为图例留出空间 */
        }
        
        /* 调整SC图例在小屏幕上的样式 */
        .sc-legend-container {
            padding: 8px 0;
            gap: 4px;
        }
        
        .sc-legend-item {
            padding: 2px 6px;
            font-size: 10px;
        }
        
        .sc-legend-color {
            width: 10px;
            height: 10px;
            margin-right: 4px;
        }
    }

    /* 为iPad和其他平板设备添加特殊处理 */
    @media (min-width: 769px) and (max-width: 1024px) {
        .material-detail-container {
            margin-top: 130px;
        }
        
        .material-nav {
            top: 60px;
        }
    }

    /* 卡片头部操作按钮样式 */
    .card-header-actions {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .download-btn {
        color: #0047AB;
        background-color: #EFF6FF;
        border: 1px solid #BFDBFE;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(0, 71, 171, 0.15);
        position: relative;
        overflow: hidden;
        margin-left: 10px;
        vertical-align: middle;
    }

    .download-btn i {
        font-size: 1.2rem;
        transition: transform 0.3s ease;
    }

    .download-btn:hover {
        color: white;
        background-color: #0047AB;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 71, 171, 0.3);
    }

    .download-btn:hover i {
        transform: scale(1.1);
    }

    .download-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 3px rgba(0, 71, 171, 0.2);
    }

    /* 三列布局专用样式 */
    .three-column-layout {
        display: flex;
        gap: 24px;
        margin-bottom: 24px;
        align-items: stretch; /* 确保所有列高度相同 */
    }

    .three-column-layout .column-60 {
        flex: 6;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .three-column-layout .column-20 {
        flex: 2;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    /* 响应式调整 */
    @media (max-width: 1200px) {
        .three-column-layout {
            flex-direction: column;
        }

        .three-column-layout .column-60,
        .three-column-layout .column-20 {
            flex: 1;
            width: 100%;
        }

        #scStructure {
            height: 500px;
            min-height: 500px;
        }
    }
    
    @media (max-width: 768px) {
        #scStructure {
            height: 375px;
            min-height: 375px;
        }
    }

/* 确保全局比例缩放时界面元素也相应调整 */
@media (min-resolution: 120dpi) {
    .material-nav, .nav-properties,
    .card-header, .card-content, .property-label, .property-value {
        transform-origin: left top;
        transform: scale(0.95);
    }
}

/* ===================== SC结构图相关样式 ===================== */
/* 响应式控制面板 */
.sc-control-panel {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding: 12px;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    position: relative;
    flex-wrap: wrap;
    gap: 8px;
}

/* 控制面板在小屏幕上的样式 */
@media (max-width: 768px) {
    .sc-control-panel {
        flex-direction: column;
        align-items: flex-start;
    }
    .sc-control-status {
        width: 100%;
        text-align: left;
        margin-top: 5px;
    }
}

/* 提示文本响应式样式 */
.sc-control-tip {
    font-size: 14px; /* 增大字体大小 */
    color: #4b5563;
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    min-width: 250px;
}

.control-tip-text {
    font-weight: 500;
    display: inline-block;
    border-left: 3px solid #0047AB;
    padding-left: 8px;
    line-height: 1.4;
}

.sc-control-tip i {
    color: #0047AB;
    font-size: 16px;
}

/* 响应式重置按钮 */
.sc-control-item {
    display: flex;
    gap: 10px;
}

.sc-control-btn {
    padding: 8px 16px;
    background: #0047AB;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 14px; /* 增大字体大小 */
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    white-space: nowrap;
}

/* 按钮悬停和活动状态 */
.sc-control-btn:hover {
    background: #00348F;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.sc-control-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 3px rgba(0,0,0,0.1);
}

.sc-control-btn.active {
    background: #003366;
}

/* 可见曲线计数样式 */
.sc-control-status {
    font-size: 14px; /* 增大字体大小 */
    color: #4b5563;
    font-weight: 500;
    background: rgba(224, 231, 255, 0.6);
    padding: 6px 12px;
    border-radius: 4px;
    border-left: 3px solid #0047AB;
}

.visible-count-text {
    white-space: nowrap;
}

/* 图例交互样式增强 */
/* 整体图例容器样式 */
.js-plotly-plot .legend {
    /* 设置圆角为8px，使图例更圆润 */
    border-radius: 8px !important;
    /* 添加微妙的阴影效果，提供层次感 */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05) !important;
}

/* 图例中每个条目的开关按钮样式 */
.js-plotly-plot .legend .traces .legendtoggle {
    /* 设置鼠标指针为手型，表示可点击 */
    cursor: pointer;
    /* 添加0.2秒的平滑过渡效果 */
    transition: all 0.1s ease;
    /* 设置圆角为4px，与整体风格统一 */
    border-radius: 4px;
}

/* 图例开关按钮悬停效果 */
.js-plotly-plot .legend .traces .legendtoggle:hover {
    /* 悬停时添加浅蓝色背景，使用主题色0047AB，透明度0.15 */
    background-color: rgba(0, 71, 171, 0.15) ;
    /* 添加发光效果，增强视觉反馈 */
    box-shadow: 0 0 8px rgba(0, 71, 171, 0.3);
}

/* 显示状态的图例项样式 */
.js-plotly-plot .legend .traces .legendtext {
    /* 添加0.2秒的平滑过渡效果，使状态变化更自然 */
    transition: all 0.2s ease;
    
    /* 设置内边距，使文本周围有适当的空白空间 */
    padding: 4px 8px;
    
    /* 添加圆角效果，使外观更现代化 */
    border-radius: 5px;
    
    /* 设置字体大小为16像素，确保清晰可读 */
    font-size: 16px ;
    
    /* 设置行高为1.4倍字体大小，优化文本间距 */
    line-height: 1.4 ;
    
    /* 设置相对定位，为后续的悬停提示做准备 */
    position: relative;
}

.js-plotly-plot .legend .traces:not([style*="opacity: 0.5"]) .legendtext {
    font-weight: 600;
    color: #1f2937 !important;
}

.js-plotly-plot .legend .traces:hover .legendtext {
    background-color: rgba(0, 71, 171, 0.1);
    transform: translateX(3px);
}

/* 隐藏状态的图例项样式 */
.js-plotly-plot .legend .traces[style*="opacity: 0.5"] .legendtext {
    text-decoration: line-through;
    color: #a0aec0 !important;
    background-color: rgba(226, 232, 240, 0.5);
    font-size: 16px !important;
}

.js-plotly-plot .legend .traces[style*="opacity: 0.5"]:hover .legendtext {
    background-color: rgba(226, 232, 240, 0.8);
    color: #718096 !important;
}

/* 图例项激活样式 */
.js-plotly-plot .legend .traces.active .legendtext {
    background-color: rgba(0, 71, 171, 0.2);
    box-shadow: 0 0 8px rgba(0, 71, 171, 0.4);
    transform: translateX(3px);
}

/* 图例悬停提示 */
.js-plotly-plot .legend .traces .legendtext::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(17, 24, 39, 0.9);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 14px;
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    pointer-events: none;
    z-index: 10;
}

.js-plotly-plot .legend .traces .legendtext:hover::after {
    opacity: 1;
    visibility: visible;
    bottom: calc(100% + 5px);
}

/* 自定义滚动条样式 */
.js-plotly-plot .legend::-webkit-scrollbar {
    width: 10px;
}

.js-plotly-plot .legend::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 6px;
}

.js-plotly-plot .legend::-webkit-scrollbar-thumb {
    background-color: #0047AB;
    border-radius: 6px;
    border: 2px solid #f1f5f9;
}

.js-plotly-plot .legend::-webkit-scrollbar-thumb:hover {
    background-color: #003380;
}

/* Firefox滚动条样式 */
.js-plotly-plot .legend {
    scrollbar-width: thin;
    scrollbar-color: #0047AB #f1f5f9;
}

/* 弹出通知样式 */
.sc-notification {
    position: absolute;
    top: -50px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #0047AB;
    color: white;
    padding: 10px 20px;
    border-radius: 6px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    z-index: 100;
    font-size: 16px;
    opacity: 1;
    transition: opacity 0.5s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

.sc-notification i {
    color: #ffff00;
    font-size: 18px;
}

/* 响应式字体大小调整 */
@media (max-width: 1200px) {
    .sc-control-tip, .sc-control-status {
        font-size: 14px;
    }
    .sc-control-btn {
        font-size: 13px;
        padding: 6px 12px;
    }
    .js-plotly-plot .legend .traces .legendtext {
        font-size: 14px !important;
    }
}

/* SC元素关系样式 */
@keyframes scrollPulse {
    0% { opacity: 0.7; }
    50% { opacity: 0.3; }
    100% { opacity: 0.7; }
}

.scrollable::after {
    content: '';
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    width: 30px;
    height: 4px;
    background-color: #0047AB;
    border-radius: 2px;
    opacity: 0.7;
    animation: scrollPulse 1.5s infinite;
}

/* 图例项整体样式 */
.js-plotly-plot .legend .traces {
    /* 为每个图例项添加底部外边距，确保图例项之间有适当间距 */
    margin-bottom: 6px !important;
    /* 为每个图例项添加底部内边距，使内容与边框保持一定距离 */
    padding-bottom: 8px !important;
    /* !important用于覆盖plotly.js的默认样式 */
}

/* 新的原子信息卡片样式 */
.atom-info-card {
    background: linear-gradient(to right, #f1f5f9, #f8fafc);
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
    gap: 12px;
    border: 1px solid #e5e7eb;
}

.atom-info-section {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
}

.atom-count {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    border: 1px solid #e5e7eb;
}

.atom-count i {
    color: #0047AB;
    font-size: 1.3rem;
}

.atom-total {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
}

.atom-total-label {
    font-size: 1.1rem;
    color: #64748b;
    margin-left: 4px;
}

.atom-composition-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    max-width: 70%;
}

.element-chip {
    display: flex;
    align-items: center;
    background: #ffffff;
    border-radius: 6px;
    padding: 6px 10px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    border: 1px solid #e5e7eb;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.element-chip:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}

.element-symbol {
    font-weight: 600;
    color: #0047AB;
    margin-right: 4px;
    font-size: 0.95rem;
}

.element-count {
    color: #64748b;
    font-size: 0.9rem;
}

.coords-display-info {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.95rem;
    color: #475569;
    padding: 8px 16px;
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    border: 1px solid #e5e7eb;
    width: fit-content;
}

.coords-display-info i {
    color: #0047AB;
}

/* 响应式调整 */
@media (max-width: 768px) {
    .atom-info-section {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .atom-composition-container {
        max-width: 100%;
    }
    
    .atom-total {
        font-size: 1.3rem;
    }
}

/* 添加脉冲动画效果 */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.pulse-animation {
    animation: pulse 0.5s ease;
}

    /* 确保SC结构图容器具有正确的高度 */
    #scStructure {
        width: 100%;
        flex-grow: 1;
        min-height: 625px;
        height: 625px;
        border-radius: 8px;
        background: #f8fafc;
        border: 2px solid #e2e8f0;
        overflow: hidden;
        transition: all 0.3s ease;
        position: relative;
        display: flex;
        flex-direction: column;
    }
    
    /* SC图表容器样式 */
    #sc-plot {
        width: 100%;
        height: 100%;
        min-height: 550px;
        flex-grow: 1;
        position: relative;
    }
    
    /* SC图例容器样式 */
    .sc-legend-container {
        width: 100%;
        padding: 10px 0;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 8px;
        background-color: #f8fafc;
        border-top: 1px solid #e2e8f0;
    }
    
    /* 图例项样式 */
    .sc-legend-item {
        display: flex;
        align-items: center;
        padding: 4px 8px;
        background-color: #ffffff;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .sc-legend-item:hover {
        background-color: #f1f5f9;
        transform: translateY(-2px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .sc-legend-color {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 6px;
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
        #scStructure {
            height: 375px;
            min-height: 375px;
        }
    }
    </style>

    <!-- ====================== 第一栏：3D结构和晶体结构 ====================== -->
    <div id="first-section" class="content-section">
        <div class="two-column-layout">
            <!-- 左侧：3D结构显示区域 (60%) -->
            <div class="column-60">
                <div class="viewer-container">
                    <div class="card-header">
        <h3>3D Structure</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="viewer-content">
        <div class="crystal-viewer" id="crystalViewer"></div>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：晶体结构信息 (40%) -->
            <div class="column-40">
                <div class="detail-card" id="crystal-structure">
                    <div class="card-header">
                        <h3>Crystal Structure</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="card-content">
                        <ul>
                            <li><span class="property-label">Lattice a:</span> <span class="property-value" id="lattice-a">Loading...</span></li>
                            <li><span class="property-label">Lattice b:</span> <span class="property-value" id="lattice-b">Loading...</span></li>
                            <li><span class="property-label">Lattice c:</span> <span class="property-value" id="lattice-c">Loading...</span></li>
                            <li><span class="property-label">α:</span> <span class="property-value" id="lattice-alpha">Loading...</span></li>
                            <li><span class="property-label">β:</span> <span class="property-value" id="lattice-beta">Loading...</span></li>
                            <li><span class="property-label">γ:</span> <span class="property-value" id="lattice-gamma">Loading...</span></li>
                            <li><span class="property-label">Volume:</span> <span class="property-value" id="lattice-volume">Loading...</span></li>
                            <li><span class="property-label">Density:</span> <span class="property-value" id="structure-density">Loading...</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ====================== 第二栏：晶体对称性和原子坐标 ====================== -->
    <div id="second-section" class="content-section">
        <div class="two-column-layout">
            <!-- 左侧：晶体对称性 -->
            <div class="column-40">
                <div class="detail-card" id="crystal-symmetry">
                    <div class="card-header collapsed">
                        <h3>Crystal Symmetry</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="card-content collapsed">
                        <ul>
                            <li><span class="property-label">Crystal System:</span> <span class="property-value" id="crystal-system">Loading...</span></li>
                            <li><span class="property-label">Space Group:</span> <span class="property-value" id="space-group">
                                {% if material.sg_name and material.sg_num %}
                                    {{ material.sg_name }} ({{ material.sg_num }})
                                {% else %}
                                    Loading...
                                {% endif %}
                            </span></li>
                            <li><span class="property-label">MP-ID:</span> <span class="property-value">{{ material.mp_id if material.mp_id else 'Unknown' }}</span></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：原子坐标 -->
            <div class="column-60">
                <div class="detail-card" id="atomic-coordinates">
                    <div class="card-header collapsed">
                        <h3>Atomic Coordinates</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="card-content collapsed">
                        <div id="atom-list">Loading atomic coordinates...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ====================== 第三栏：能带信息和能带性质 ====================== -->
    <div id="third-section" class="content-section">
        <div class="two-column-layout">
            <!-- 左侧：能带图 (60%) -->
            <div class="column-60">
                <div class="viewer-container">
                    <div class="card-header collapsed">
        <h3>Band Structure
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('static', filename='materials/' + material.formatted_id + '/band/band.dat') }}" download class="download-btn" title="Download band data">
                <i class="fas fa-download"></i>
            </a>
            {% endif %}
        </h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="viewer-content card-content collapsed">
        <div id="bandStructure"></div>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：能带结构属性 (40%) -->
            <div class="column-40">
                <div class="detail-card" id="band-structure">
                    <div class="card-header collapsed">
                        <h3>Band Structure</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="card-content collapsed">
                        <ul>
                            <li id="band-gap"><span class="property-label">Band Gap:</span>
                                <span class="property-value">
                                    {% if material.band_gap is not none %}
                                        {{ "%.4f"|format(material.band_gap) }} eV
                                    {% else %}
                                        Analyzing...
                                    {% endif %}
                                </span>
                            </li>
                            <li id="material-type"><span class="property-label">Materials Type:</span>
                                <span class="property-value">
                                    {% if material.materials_type %}
                                        {{ material.materials_type|title }}
                                    {% else %}
                                        Analyzing...
                                    {% endif %}
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ====================== SC部分：SC结构图 ====================== -->
    <div id="sc-section" class="content-section">
        <div class="two-column-layout">
            <!-- 左侧：SC图 (70%) -->
            <div class="column-70">
                <div class="viewer-container">
                    <div class="card-header collapsed">
                        <h3>Shift Current
                            {% if current_user.is_authenticated %}
                            <a href="{{ url_for('static', filename='materials/' + material.formatted_id + '/sc/sc.dat') }}" download class="download-btn" title="Download Shift Current data">
                                <i class="fas fa-download"></i>
                            </a>
                            {% endif %}
                        </h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="viewer-content card-content collapsed">
                        <div id="scStructure"></div>
                    </div>
                </div>
            </div>

            <!-- 右侧：Element Relations & Shift Current Properties (30%) -->
            <div class="column-30">
                <div class="detail-card" id="sc-properties-combined">
                    <div class="card-header collapsed">
                        <div class="tab-header">
                            <button class="tab-button active" data-tab="element-relations">Element Relations</button>
                            <button class="tab-button" data-tab="shift-current">Shift Current Properties</button>
                        </div>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="card-content collapsed">
                        <!-- Element Relations Tab Content -->
                        <div class="tab-content active" id="element-relations-content">
                        <!-- 元素关系表格在此显示 -->
                        <style>
                            /* 标签页样式 */
                            .tab-header {
                                display: flex;
                                border-bottom: 2px solid #e5e7eb;
                                margin-bottom: 15px;
                                gap: 0;
                            }
                            .tab-button {
                                flex: 1;
                                padding: 12px 16px;
                                background: #f8fafc;
                                border: none;
                                border-bottom: 3px solid transparent;
                                cursor: pointer;
                                font-size: 16px;
                                font-weight: 500;
                                color: #64748b;
                                transition: all 0.3s ease;
                                border-radius: 6px 6px 0 0;
                                margin-bottom: -2px;
                                white-space: nowrap;
                                overflow: hidden;
                                text-overflow: ellipsis;
                            }
                            .tab-button:hover {
                                background: #f1f5f9;
                                color: #475569;
                            }
                            .tab-button.active {
                                background: #ffffff;
                                color: #1e293b;
                                border-bottom-color: #3b82f6;
                                font-weight: 600;
                            }
                            .tab-content {
                                display: none;
                            }
                            .tab-content.active {
                                display: block;
                            }

                            /* Element Relations 表格样式 */
                            .relations-table {
                                font-size: 14px;
                            }
                            .relations-table table {
                                width: 100%;
                                border-collapse: collapse;
                            }
                            .relations-table th,
                            .relations-table td {
                                padding: 8px;
                                text-align: left;
                                border-bottom: 1px solid #e5e7eb;
                            }
                            .relations-table th {
                                background-color: #f1f5f9;
                                font-weight: 600;
                                color: #334155;
                            }
                            .relations-table tr:hover {
                                background-color: #f8fafc;
                            }
                            .zero-group {
                                color: #6B7280;
                                font-style: italic;
                            }
                            .same-relation {
                                color: #0047AB;
                                font-weight: 500;
                            }
                            .opposite-relation {
                                color: #B91C1C;
                                font-weight: 500;
                            }
                            .mixed-relation {
                                color: #7E22CE;
                                font-weight: 500;
                            }
                            .single-curve {
                                color: #4B5563;
                            }
                            .relations-header {
                                margin-bottom: 15px;
                                border-bottom: 1px solid #e5e7eb;
                                padding-bottom: 10px;
                            }
                            .relations-legend {
                                list-style: none;
                                padding: 0;
                                margin: 0;
                                display: flex;
                                gap: 15px;
                                justify-content: center;
                            }
                            .relations-legend li {
                                display: flex;
                                align-items: center;
                                font-size: 12px;
                                color: #4B5563;
                            }
                            .zero-indicator {
                                color: #6B7280;
                                font-size: 16px;
                                margin-right: 5px;
                            }
                            .same-indicator {
                                color: #0047AB;
                                font-size: 16px;
                                margin-right: 5px;
                            }
                            .opposite-indicator {
                                color: #B91C1C;
                                font-size: 16px;
                                margin-right: 5px;
                            }
                        </style>
                        
                        <div class="relations-header">
                            <ul class="relations-legend">
                                <li><span class="zero-indicator">●</span> Zero</li>
                                <li><span class="same-indicator">●</span> Same</li>
                                <li><span class="opposite-indicator">●</span> Opposite</li>
                            </ul>
                        </div>
                        
                            <div id="relations-table-container">
                                <div class="loading-message">
                                    Loading element relations...
                                </div>
                            </div>
                        </div>

                        <!-- Shift Current Properties Tab Content -->
                        <div class="tab-content" id="shift-current-content">
                            <ul>
                                <li><span class="property-label">Max SC:</span>
                                    <span class="property-value">
                                        {% if material.max_sc is not none %}
                                            {{ "%.4f"|format(material.max_sc) }} μA/V²
                                        {% else %}
                                            Unknown
                                        {% endif %}
                                    </span>
                                </li>
                                <li><span class="property-label">Max Photon Energy:</span>
                                    <span class="property-value">
                                        {% if material.max_photon_energy is not none %}
                                            {{ "%.4f"|format(material.max_photon_energy) }} eV
                                        {% else %}
                                            Unknown
                                        {% endif %}
                                    </span>
                                </li>
                                <li><span class="property-label">Max Tensor Type:</span>
                                    <span class="property-value">{{ material.max_tensor_type if material.max_tensor_type else 'Unknown' }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ====================== 第四栏：基本信息和表面属性 ====================== -->
    <div id="fourth-section" class="content-section">
        <div class="two-column-layout">
            <!-- 左侧：基本属性 -->
            <div class="column-40">
                <div class="detail-card" id="basic-properties">
                    <div class="card-header collapsed">
                        <h3>Basic Properties</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="card-content collapsed">
                        <ul>
                            <li><span class="property-label">ID:</span> <span class="property-value">{{ material.formatted_id }}</span></li>
                            <li><span class="property-label">Status:</span> <span class="property-value">{{ material.status or 'Not available yet' }}</span></li>
                            <li><span class="property-label">Fermi Level:</span> <span class="property-value">{{ material.fermi_level ~ ' eV' if material.fermi_level is not none else 'Not available yet' }}</span></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：表面属性 -->
            <div class="column-40">
                <div class="detail-card" id="surface-properties">
                    <div class="card-header collapsed">
                        <h3>Surface Properties</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div class="card-content collapsed">
                        <ul>
                            <li><span class="property-label">Vacuum Level:</span> <span class="property-value">Not available yet</span></li>
                            <li><span class="property-label">Work Function:</span> <span class="property-value">Not available yet</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript区域 -->
<!-- 引入材料详情页面的JavaScript文件 -->
<script src="{{ url_for('static', filename='js/material-detail.js') }}"></script>

<!-- 标签页切换功能 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 标签页切换功能
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');

            // 移除所有活动状态
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            // 激活当前标签页
            this.classList.add('active');

            // 显示对应内容
            if (targetTab === 'element-relations') {
                document.getElementById('element-relations-content').classList.add('active');
            } else if (targetTab === 'shift-current') {
                document.getElementById('shift-current-content').classList.add('active');
            }
        });
    });
});
</script>

<!-- 使用JSON script标签安全地传递材料数据到前端 -->
<!-- 这种方法避免了在JavaScript代码中使用Jinja2语法，IDE不会报错 -->
<script id="material-data" type="application/json">
{
    "id": {{ material.id }},
    "name": {{ material.name|tojson }},
    "max_sc": {{ material.max_sc if material.max_sc is not none else 'null' }},
    "max_photon_energy": {{ material.max_photon_energy if material.max_photon_energy is not none else 'null' }},
    "max_tensor_type": {{ (material.max_tensor_type if material.max_tensor_type else 'Unknown')|tojson }},
    "materials_type": "Unknown",
    "band_data_path": "/static/materials/{{ material.formatted_id }}/band/band.dat",
    "sc_data_path": "/static/materials/{{ material.formatted_id }}/sc/sc.dat"
}
</script>
{% endblock %}
