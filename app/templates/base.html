<!DOCTYPE html>
<html lang="{{ current_locale or 'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ _('NLHE Database - Nonlinear Hall Effect Materials Database') }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/detail.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/buttons.css', v='20250913') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/forms.css', v='20250913') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/menus.css', v='20250913') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/tables.css', v='20250913') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/periodic_table.css', v='20250913') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base/navbar.css', v='20250913') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base/footer.css', v='20250913') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base/loader.css', v='20250913') }}">
    {% block page_styles %}{% endblock %}
    <style>
        /* ========== 全局变量和基础样式 ========== */
        :root {
            /* Theme colors */
            --primary-color: #0047AB;    /* Cobalt blue - primary color */
            --secondary-color: #1E5CB3;   /* Lighter blue */
            --accent-color: #007FFF;      /* Sky blue - accent color */
            --text-color: #333333;        /* Dark gray text */
            --light-bg: #F5F8FF;          /* Very light blue background */
            
    
            /* Shadows and borders */
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.08);
            --input-border: #D9E2F0;
            --input-focus: #0047AB;
            --button-hover: #003A8C;
            
            /* Spacing and font sizes */
            --spacing-xs: 0.25rem;    /* 4px */
            --spacing-sm: 0.5rem;     /* 8px */
            --spacing-md: 1rem;       /* 16px */
            --spacing-lg: 1.5rem;     /* 24px */
            --spacing-xl: 2rem;       /* 32px */
            
            /* Font sizes - using clamp for responsive sizing */
            --font-size-sm: clamp(0.75rem, 0.8vw, 0.875rem);
            --font-size-base: clamp(0.875rem, 1vw, 1rem);
            --font-size-lg: clamp(1rem, 1.2vw, 1.25rem);
            --font-size-xl: clamp(1.25rem, 1.5vw, 1.5rem);
            
            /* Button styles */
            --button-padding: 0.5rem 1rem;
            --button-radius: 0.375rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-bg);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 10px;
        }
        
        /* ========== 公共组件样式 ========== */
        /* 按钮基础样式 
         * 定义了网站通用的按钮样式
         * 使用CSS变量确保样式的一致性和可维护性
         * 包含了悬停效果和过渡动画
         */
        .btn {
            background-color: var(--primary-color); /* 使用主题色作为背景 */
            color: white; /* 按钮文字为白色 */
            text-decoration: none; /* 移除文字下划线 */
            padding: var(--button-padding); /* 使用预定义的内边距 */
            border-radius: var(--button-radius); /* 圆角边框 */
            transition: background-color 0.3s; /* 背景色变化动画 */
            cursor: pointer; /* 鼠标悬停时显示手型光标 */
            border: none; /* 移除边框 */
            font-weight: 500; /* 字体加粗程度 */
            display: inline-flex; /* 使用inline-flex布局便于对齐 */
            align-items: center; /* 垂直居中对齐 */
            gap: var(--spacing-sm); /* 元素之间的间距 */
            font-size: var(--font-size-base); /* 使用基础字体大小 */
        }

        /* 按钮悬停效果 */
        .btn:hover {
            background-color: var(--button-hover); /* 悬停时变暗 */
        }

        /* 输入框通用样式 
         * 适用于文本输入框、下拉选择框和文本区域
         * 包含了焦点状态的样式变化
         */
        input, select, textarea {
            width: 100%; /* 宽度占满容器 */
            padding: var(--spacing-sm); /* 内边距 */
            border: 1px solid var(--input-border); /* 边框样式 */
            border-radius: var(--button-radius); /* 圆角边框 */
            font-size: var(--font-size-base); /* 字体大小 */
            transition: border-color 0.3s; /* 边框颜色变化动画 */
        }

        /* 输入框获得焦点时的样式 */
        input:focus,
        select:focus,
        textarea:focus {
            outline: none; /* 移除默认的焦点轮廓 */
            border-color: var(--input-focus); /* 边框变为主题色 */
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1); /* 添加柔和的阴影效果 */
        }
        
        /* 主内容区域样式 
         * 定义了页面主要内容的布局和间距
         */
        .main-content {
            padding-top: var(--navbar-height, 74px); /* 动态匹配导航栏高度 */
            min-height: calc(100vh - 350px); /* 最小高度确保页面填充 */
            margin-top: 0; /* 移除顶部外边距 */
            background-color: var(--light-bg); /* 使用浅色背景 */
        }

        /* 材料详情页面的特殊调整 */
        .main-content .material-detail-container {
            padding-top: 0; /* 移除顶部内边距 */
        }

        
    </style>
</head>
<body>
    <!-- ========== 导航栏 ========== -->
    <nav class="navbar">
        <div class="container nav-content">
            <a href="{{ url_for('views.landing') }}" class="logo"><i class="fas fa-database"></i> {{ _('Database') }}</a>
            <div class="nav-links">
                <a href="{{ url_for('views.index') }}">
                    <i class="fas fa-table"></i> {{ _('Database') }}
                </a>
                <a href="{{ url_for('articles.listing') }}">
                    <i class="fas fa-book"></i> {{ _('Contents') }}
                </a>
                <div class="dropdown">
                    <a href="#" class="dropdown-toggle" id="tools-dropdown">
                        <i class="fas fa-tools"></i> {{ _('Tools') }} <i class="fas fa-caret-down"></i>
                    </a>
                    <div class="dropdown-menu" id="tools-menu">
                        <a href="https://materialsproject.org/ml" target="_blank">
                            <i class="fas fa-brain"></i> {{ _('MP Machine Learning') }}
                        </a>
                        <a href="https://www.materialscloud.org/work/tools" target="_blank">
                            <i class="fas fa-cloud"></i> {{ _('Materials Cloud Tools') }}
                        </a>
                        <a href="https://nomad-lab.eu/nomad-lab/" target="_blank">
                            <i class="fas fa-atom"></i> {{ _('NOMAD Laboratory') }}
                        </a>
                    </div>
                </div>
                <!-- 登录用户专用功能按钮 -->
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('siliconflow.chat') }}">
                    <i class="fas fa-robot"></i> {{ _('SiliconFlow LLM') }}
                </a>
                <a href="{{ url_for('program.index') }}">
                    <i class="fas fa-cogs"></i> {{ _('Program') }}
                </a>
                {% endif %}

                <!-- 管理员专用按钮 -->
                {% if current_user.is_authenticated and current_user.is_admin() %}
                <a href="{{ url_for('views.add') }}">
                    <i class="fas fa-plus"></i> {{ _('Add') }}
                </a>
                {% endif %}

                <!-- 未登录用户显示登录按钮 -->
                {% if not current_user.is_authenticated %}
                <a href="{{ url_for('views.login') }}">
                    <i class="fas fa-sign-in-alt"></i> {{ _('Login') }}
                </a>
                {% endif %}

                <!-- 自适应收纳：更多下拉（默认隐藏，JS控制显示） -->
                <div class="dropdown more-dropdown" id="more-dropdown" aria-label="More">
                    <a href="#" class="dropdown-toggle" id="more-toggle">
                        <i class="fas fa-ellipsis-h"></i> {{ _('More') }}
                    </a>
                    <div class="dropdown-menu" id="more-menu"></div>
                </div>

                <!-- 用户类型提示区域，头像+用户名+下拉菜单 -->
                <div class="user-type-indicator user-dropdown">
                    {% if current_user.is_authenticated and current_user.is_admin() %}
                        <span class="user-avatar admin user-dropdown-toggle"><i class="fas fa-user-circle"></i></span>
                        <span class="user-name user-dropdown-toggle">{{ current_user.username }}</span>
                        <div class="user-dropdown-menu">
                            <a href="{{ url_for('views.logout') }}"><i class="fas fa-sign-out-alt"></i> {{ _('Logout') }}</a>
                        </div>
                    {% elif current_user.is_authenticated %}
                        <span class="user-avatar user user-dropdown-toggle"><i class="fas fa-user-circle"></i></span>
                        <span class="user-name user-dropdown-toggle">{{ current_user.username }}</span>
                        <div class="user-dropdown-menu">
                            <a href="{{ url_for('views.logout') }}"><i class="fas fa-sign-out-alt"></i> {{ _('Logout') }}</a>
                        </div>
                    {% else %}
                        <span class="user-avatar guest"><i class="fas fa-user-circle"></i></span>
                        <span class="user-name">{{ _('Guest') }}</span>
                    {% endif %}
                </div>
                <!-- 结束 -->

                <!-- 语言切换下拉 -->
                <div class="dropdown">
                    <a href="#" class="dropdown-toggle" id="lang-dropdown">
                        <i class="fas fa-language"></i> {{ _('Language') }} <i class="fas fa-caret-down"></i>
                    </a>
                    <div class="dropdown-menu" id="lang-menu">
                        <a href="{{ url_for('views.set_language', lang='en') }}" hreflang="en">{{ _('English') }}</a>
                        <a href="{{ url_for('views.set_language', lang='zh') }}" hreflang="zh">{{ _('中文') }}</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- [Deprecated 20250913] 导航栏样式已迁移至 static/css/base/navbar.css -->

    <!-- ========== 主内容区域 ========== -->
    <div class="main-content">
        <!-- Flash Messages -->
        <div class="flash-messages">
            <div class="container">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="flash-message {{ category }}">
                                <div class="message-content">
                                    <i class="fas {% if category == 'success' %}fa-check-circle{% elif category == 'error' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %}"></i>
                                    <span>{{ message }}</span>
                                </div>
                                <button class="close-flash">&times;</button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
        </div>

        {% block content %}{% endblock %}
    </div>

    <!-- ========== 页脚 ========== -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>{{ _('Database') }}</h3>
                    <p>{{ _('Materials Database') }}</p>
                    <p>{{ _('Explore and discover novel materials') }}</p>
                </div>
                <div class="footer-section">
                    <h3>{{ _('We') }}</h3>
                    <ul>
                        <li><a href="{{ url_for('views.members') }}">{{ _('Team') }}</a></li>
                        <li><a href="#">{{ _('Publications') }}</a></li>
                        <li><a href="#">{{ _('Achievements') }}</a></li>
                        <li><a href="#">{{ _('Join Us') }}</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>{{ _('Related Links') }}</h3>
                    <ul>
                        <li><a href="https://gs.imr.ac.cn/" target="_blank">{{ _('IMR Graduate School, CAS') }}</a></li>
                        <li><a href="http://www.imr.cas.cn/" target="_blank">{{ _('Institute of Metal Research, CAS') }}</a></li>
                        <li><a href="https://www.cas.cn/" target="_blank">{{ _('Chinese Academy of Sciences') }}</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>{{ _('Contact Us') }}</h3>
                    <p>{{ _('Address: 72 Wenhua Road, Shenhe District, Shenyang') }}</p>
                    <p>{{ _('Postal Code: 110016') }}</p>
                    <p>{{ _('Email: contact@nlhe-database.org') }}</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 {{ _('NLHE Database.') }} {{ _('Powered by') }} <a href="https://github.com/pallets/flask">Flask</a> & <a href="https://github.com/jwzhukevin/watchlist">Code</a></p>
            </div>
        </div>
    </footer>

    <!-- [Deprecated 20250913] 页脚样式已迁移至 static/css/base/footer.css -->
    
    <!-- ========== 下拉菜单和消息提示脚本 ========== -->
    <script>
        // 当DOM内容加载完成后执行脚本
        document.addEventListener('DOMContentLoaded', function() {
            // 获取工具下拉菜单相关元素
            const toolsDropdown = document.getElementById('tools-dropdown'); // 下拉按钮
            const toolsMenu = document.getElementById('tools-menu'); // 下拉菜单内容
            
            // 为下拉按钮添加点击事件监听器
            // 点击时切换菜单的显示状态
            toolsDropdown.addEventListener('click', function(e) {
                e.preventDefault(); // 阻止默认行为
                toolsMenu.classList.toggle('show'); // 切换show类来显示/隐藏菜单
            });
            
            // 点击页面其他区域时关闭下拉菜单
            // 这是一个常见的交互模式,提升用户体验
            document.addEventListener('click', function(e) {
                // 检查点击是否发生在下拉菜单区域外
                if (!toolsDropdown.contains(e.target) && !toolsMenu.contains(e.target)) {
                    toolsMenu.classList.remove('show'); // 隐藏菜单
                }
            });

            // 语言下拉菜单交互
            const langDropdown = document.getElementById('lang-dropdown');
            const langMenu = document.getElementById('lang-menu');
            if (langDropdown && langMenu) {
                langDropdown.addEventListener('click', function(e) {
                    e.preventDefault();
                    langMenu.classList.toggle('show');
                });
                document.addEventListener('click', function(e) {
                    if (!langDropdown.contains(e.target) && !langMenu.contains(e.target)) {
                        langMenu.classList.remove('show');
                    }
                });
            }

            // 处理Flash消息关闭按钮的点击事件
            document.querySelectorAll('.close-flash').forEach(button => {
                button.addEventListener('click', function() {
                    const flashMessage = this.parentElement;
                    flashMessage.classList.add('hide');
                    setTimeout(() => {
                        flashMessage.remove();
                    }, 400);
                });
            });

            // 自动关闭Flash消息（3秒后右侧滑出）
            setTimeout(() => {
                document.querySelectorAll('.flash-message').forEach(message => {
                    if (message) {
                        message.style.animation = 'slideOutToRight 0.5s ease-in forwards';
                        setTimeout(() => {
                            if (message.parentElement) {
                                message.remove();
                            }
                        }, 500);
                    }
                });
            }, 3000);

            // 用户头像+用户名下拉菜单交互
            (function(){
                const dropdown = document.querySelector('.user-type-indicator.user-dropdown');
                if (!dropdown) return;
                const toggles = dropdown.querySelectorAll('.user-dropdown-toggle');
                toggles.forEach(el => {
                    el.addEventListener('click', function(e) {
                        e.stopPropagation();
                        dropdown.classList.toggle('active');
                    });
                });
                document.addEventListener('click', function(e) {
                    if (!dropdown.contains(e.target)) {
                        dropdown.classList.remove('active');
                    }
                });
            })();

            // ===== 自适应：将低优先级导航项收纳到“更多” =====
            const navLinks = document.querySelector('.nav-links');
            const moreDropdown = document.getElementById('more-dropdown');
            const moreToggle = document.getElementById('more-toggle');
            const moreMenu = document.getElementById('more-menu');

            if (moreToggle && moreMenu) {
                moreToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    moreMenu.classList.toggle('show');
                });
                document.addEventListener('click', function(e){
                    if (!moreDropdown.contains(e.target)) {
                        moreMenu.classList.remove('show');
                    }
                });
            }

            function isFixed(node) {
                if (!node || node.nodeType !== 1) return true;
                // 保留：语言下拉、用户区、“更多”自身
                if (node.id === 'more-dropdown') return true;
                if (node.classList.contains('user-type-indicator')) return true;
                const toggle = node.querySelector('#lang-dropdown');
                if (toggle) return true;
                return false;
            }

            function currentItems() {
                // 可移动的候选：nav-links 直接子元素
                return Array.from(navLinks.children).filter(el => el && el.nodeType === 1);
            }

            function measureOverflow() {
                return navLinks.scrollWidth > navLinks.clientWidth + 2; // 容忍2px误差
            }

            function moveToMore(el) {
                if (!moreDropdown || !moreMenu) return;
                moreDropdown.style.display = '';
                // 将原元素移入 moreMenu，保持可点击（直接附加）
                moreMenu.appendChild(el);
            }

            function moveBackFromMore() {
                if (!moreMenu || !moreDropdown) return;
                // 将 moreMenu 中的第一个项目移回（先进先出）
                const item = moreMenu.firstElementChild;
                if (item) {
                    // 在 "更多" 按钮前插入
                    navLinks.insertBefore(item, moreDropdown);
                }
            }

            function compactOnce() {
                // 先尝试释放空间（把已收纳的移回），再判断是否仍溢出
                let safeGuard = 50; // 防止死循环
                while (moreMenu && moreMenu.children.length && !measureOverflow() && safeGuard-- > 0) {
                    moveBackFromMore();
                }
                // 若仍溢出，从右往左移动非固定项
                safeGuard = 50;
                while (measureOverflow() && safeGuard-- > 0) {
                    const items = currentItems();
                    // 从倒数第一个开始寻找可移动项
                    let moved = false;
                    for (let i = items.length - 1; i >= 0; i--) {
                        const el = items[i];
                        if (isFixed(el)) continue;
                        moveToMore(el);
                        moved = true;
                        break;
                    }
                    if (!moved) break; // 没有可移动项
                }
                // 如果更多里没有内容则隐藏
                if (moreDropdown) {
                    moreDropdown.style.display = (moreMenu && moreMenu.children.length) ? '' : 'none';
                }
            }

            // 初始执行与窗口变化监听
            compactOnce();
            window.addEventListener('resize', () => {
                // 为防抖，简化处理：直接调用一次
                compactOnce();
            });

            // ===== 动态设置导航高度，消除英雄模块与导航之间的间隙 =====
            const navbarEl = document.querySelector('.navbar');
            function setNavbarHeightVar() {
                if (!navbarEl) return;
                const h = Math.max(0, navbarEl.offsetHeight || 74);
                document.documentElement.style.setProperty('--navbar-height', h + 'px');
            }
            // 初次计算
            setNavbarHeightVar();
            // 在窗口尺寸变化时更新
            window.addEventListener('resize', setNavbarHeightVar);
            // 在字体加载或图片/图标渲染后可能高度变化，使用延时与加载事件兜底
            window.addEventListener('load', setNavbarHeightVar);
            setTimeout(setNavbarHeightVar, 150);
            setTimeout(setNavbarHeightVar, 400);
            // 观察导航内部结构变化（登录状态变化、更多收纳等）
            if (window.MutationObserver && navbarEl) {
                const mo = new MutationObserver(() => setNavbarHeightVar());
                mo.observe(navbarEl, { childList: true, subtree: true, attributes: true });
            }
        });
    </script>

    <!-- 全局加载遮罩（默认显示，DOMContentLoaded 后自动隐藏） -->
    <div id="global-loader" aria-live="polite" aria-busy="true" style="display:none;align-items:center;justify-content:center;position:fixed;inset:0;background:rgba(255,255,255,0.92);z-index:9999;">
        <div style="display:flex;flex-direction:column;align-items:center;gap:14px;">
            <!-- 灰色图框容器 -->
            <div style="background:#f5f5f5;border:1px solid #d1d5db;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.08);padding:12px;">
                <!-- 内框线（8px 边距）通过额外容器实现 -->
                <div style="position:relative;width:960px;height:600px;background:#ffffff;border-radius:10px;">
                    <canvas id="band-loader-canvas" width="960" height="600" style="display:block;width:960px;height:600px;border-radius:6px;"></canvas>
                </div>
            </div>
        </div>
    </div>
    <!-- [Deprecated 20250913] 全局加载器样式已迁移至 static/css/base/loader.css -->
    <script src="{{ url_for('static', filename='js/loader.js') }}"></script>

</body>
</html>